@echo off
REM Script de configuration pour Windows - ERP MÃ©tallerie

echo.
echo ğŸš€ Configuration de l'ERP Metallerie...
echo.

REM VÃ©rifier Node.js
echo ğŸ“Œ Verification de Node.js...
node --version >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ Node.js n'est pas installe. Veuillez installer Node.js 18.17 ou superieur.
    echo ğŸ‘‰ https://nodejs.org/
    pause
    exit /b 1
)

for /f "tokens=2 delims=v" %%i in ('node -v') do set NODE_VERSION=%%i
echo âœ… Node.js v%NODE_VERSION% detecte
echo.

REM DÃ©tection du gestionnaire de paquets
echo ğŸ“Œ Detection du gestionnaire de paquets...
if exist "pnpm-lock.yaml" (
    set PKG_MANAGER=pnpm
) else if exist "yarn.lock" (
    set PKG_MANAGER=yarn
) else (
    set PKG_MANAGER=npm
)
echo âœ… Utilisation de %PKG_MANAGER%
echo.

REM Installer les dÃ©pendances
echo ğŸ“¦ Installation des dependances...
call %PKG_MANAGER% install
echo.

REM CrÃ©er le fichier .env.local s'il n'existe pas
if not exist ".env.local" (
    echo ğŸ”§ Creation du fichier .env.local...
    copy .env.example .env.local >nul
    echo âœ… Fichier .env.local cree
    echo âš ï¸  N'oubliez pas de configurer vos variables d'environnement dans .env.local
    echo.
)

REM VÃ©rifier les types TypeScript
echo ğŸ” Verification des types TypeScript...
call %PKG_MANAGER% run type-check
if %errorlevel% neq 0 (
    echo âš ï¸  Quelques erreurs de type detectees (normal au premier lancement)
)
echo.

REM Lancer l'application
echo ğŸ‰ Lancement de l'application...
echo ğŸ‘‰ L'application sera accessible sur http://localhost:3000
echo.
echo ğŸ“ Compte de demonstration:
echo    Email: demo@metallerie.fr
echo    Mot de passe: password
echo.

call %PKG_MANAGER% run dev